"use strict";var NetCDFReader=function(){function t(e){var n=new IOBuffer(utils.createInputBuffer(e));n.seek(0),n.setBigEndian(),utils.notNetcdf(n.readChars(3)!=="CDF","should start with CDF");var r=n.readByte();utils.notNetcdf(r>2,"unknown version"),this.header=header.readHeader(n,r),this.buffer=n}return Object.defineProperty(t.prototype,"version",{get:function(){return this.header.version===1?"classic format":"64-bit offset format"},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"recordDimension",{get:function(){return this.header.recordDimension},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dimensions",{get:function(){return this.header.dimensions},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"globalAttributes",{get:function(){return this.header.globalAttributes},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"variables",{get:function(){return this.header.variables},enumerable:!1,configurable:!0}),t.prototype.getAttribute=function(e){var n=utils.find(this.globalAttributes,e);return n?n.value:null},t.prototype.getDataVariableAsString=function(e){var n=this.getDataVariable(e);return n?n.join(""):null},t.prototype.toString=function(){return debug.toString(this)},t.prototype.dataVariableExists=function(e){var n=utils.find(this.header.variables,e);return n!==void 0},t.prototype.attributeExists=function(e){var n=utils.find(this.globalAttributes,e);return n!==void 0},t.prototype.getDataVariable=function(e){var n;return typeof e=="string"?n=utils.find(this.header.variables,e):n=e,utils.notNetcdf(n===void 0,"variable not found: ".concat(e)),this.buffer.seek(n.offset),n.record?Type.record(this.buffer,n,this.header.recordDimension):Type.nonRecord(this.buffer,n)},t.fetch=function(e,n){var r=new XMLHttpRequest;r.open("GET",e),r.responseType="arraybuffer",r.send(),r.onreadystatechange=function(){if(r.readyState===4){var a=new Uint8Array(r.response),o=new t(a);n(o)}}},t}(),debug;(function(t){function e(n){var r=[];r.push("DIMENSIONS");for(var a=0,o=n.dimensions;a<o.length;a++){var s=o[a];r.push("  ".concat(s.name.padEnd(30)," = size: ").concat(s.size))}r.push(""),r.push("GLOBAL ATTRIBUTES");for(var i=0,f=n.globalAttributes;i<f.length;i++){var c=f[i];r.push("  ".concat(c.name.padEnd(30)," = ").concat(c.value))}var u=JSON.parse(JSON.stringify(n.variables));r.push(""),r.push("VARIABLES:");for(var h=0,l=u;h<l.length;h++){var d=l[h];d.value=n.getDataVariable(d);var v=JSON.stringify(d.value);v.length>50&&(v=v.substring(0,50)),isNaN(d.value.length)||(v+=" (length: ".concat(d.value.length,")")),r.push("  ".concat(d.name.padEnd(30)," = ").concat(v))}return r.join(`
`)}t.toString=e})(debug||(debug={}));var utils;(function(t){function e(s,i){if(s)throw new TypeError("Not a valid NetCDF v3.x file: ".concat(i))}t.notNetcdf=e;function n(s){s.offset%4!==0&&s.skip(4-s.offset%4)}t.padding=n;function r(s){if(!s||s==null)throw"empty data is not allowed!";return s instanceof ArrayBuffer?s:new Uint8Array(s)}t.createInputBuffer=r;function a(s){var i=s.readUint32(),f=s.readChars(i);return n(s),f}t.readName=a;function o(s,i){for(var f=0,c=s;f<c.length;f++){var u=c[f];if(u.name===i)return u}return null}t.find=o})(utils||(utils={}));var header;(function(t){function e(r){var a=r.readUint32();return a===t.ZERO?(utils.notNetcdf(r.readUint32()!==t.ZERO,"wrong empty tag for list of attributes"),[]):(utils.notNetcdf(a!==t.NC_ATTRIBUTE,"wrong tag for list of attributes"),n(r))}t.attributesList=e;function n(r){for(var a=r.readUint32(),o=new Array(a),s=0;s<a;s++){var i=utils.readName(r),f=r.readUint32();utils.notNetcdf(f<1||f>6,"non valid type ".concat(f));var c=r.readUint32(),u=Type.readType(r,f,c);utils.padding(r),o[s]={name:i,type:Type.num2str(f),value:u}}return o}})(header||(header={}));var header;(function(t){var e=0;function n(a){var o=a.readUint32();return o===t.ZERO?(utils.notNetcdf(a.readUint32()!==t.ZERO,"wrong empty tag for list of dimensions"),{dimensions:[],recordId:null,recordName:null}):(utils.notNetcdf(o!==t.NC_DIMENSION,"wrong tag for list of dimensions"),r(a))}t.dimensionsList=n;function r(a){for(var o=a.readUint32(),s=null,i=null,f=new Array(o),c=0;c<o;c++){var u=utils.readName(a),h=a.readUint32();h===e&&(s=c,i=u),f[c]={name:u,size:h}}return{dimensions:f,recordId:s,recordName:i}}})(header||(header={}));var header;(function(t){function e(r,a,o){var s=r.readUint32();return s===t.ZERO?(utils.notNetcdf(r.readUint32()!==t.ZERO,"wrong empty tag for list of variables"),{variables:[],recordStep:null}):(utils.notNetcdf(s!==t.NC_VARIABLE,"wrong tag for list of variables"),n(r,a,o))}t.variablesList=e;function n(r,a,o){for(var s=r.readUint32(),i=new Array(s),f=0,c=0;c<s;c++){for(var u=utils.readName(r),h=r.readUint32(),l=new Array(h),d=0;d<h;d++)l[d]=r.readUint32();var v=t.attributesList(r),p=r.readUint32();utils.notNetcdf(p<1&&p>6,"non valid type ".concat(p));var g=r.readUint32(),y=r.readUint32();o===2&&(utils.notNetcdf(y>0,"offsets larger than 4GB not supported"),y=r.readUint32());var w=!1;typeof a<"u"&&l[0]===a&&(f+=g,w=!0),i[c]={name:u,dimensions:l,attributes:v,type:Type.num2str(p),size:g,offset:y,record:w}}return{variables:i,recordStep:f}}})(header||(header={}));var header;(function(t){t.ZERO=0,t.NC_DIMENSION=10,t.NC_VARIABLE=11,t.NC_ATTRIBUTE=12;function e(n,r){var a={recordDimension:{length:n.readUint32()}};a.version=r;var o=t.dimensionsList(n);a.recordDimension.id=o.recordId,a.recordDimension.name=o.recordName,a.dimensions=o.dimensions,a.globalAttributes=t.attributesList(n);var s=t.variablesList(n,o.recordId,r);return a.variables=s.variables,a.recordDimension.recordStep=s.recordStep,a}t.readHeader=e})(header||(header={}));var defaultByteLength=1024*8,IOBuffer=function(){function t(e,n){e===void 0&&(e=defaultByteLength),n===void 0&&(n={});var r=!1;typeof e=="number"?e=new ArrayBuffer(e):(r=!0,this.lastWrittenByte=e.byteLength);var a=n.offset?n.offset>>>0:0,o=e.byteLength-a,s=a;(ArrayBuffer.isView(e)||e instanceof t)&&(e.byteLength!==e.buffer.byteLength&&(s=e.byteOffset+a),e=e.buffer),r?this.lastWrittenByte=o:this.lastWrittenByte=0,this.buffer=e,this.length=o,this.byteLength=o,this.byteOffset=s,this.offset=0,this.littleEndian=!0,this._data=new DataView(this.buffer,s,o),this._mark=0,this._marks=[]}return t.prototype.available=function(e){return e===void 0&&(e=1),this.offset+e<=this.length},t.prototype.isLittleEndian=function(){return this.littleEndian},t.prototype.setLittleEndian=function(){return this.littleEndian=!0,this},t.prototype.isBigEndian=function(){return!this.littleEndian},t.prototype.setBigEndian=function(){return this.littleEndian=!1,this},t.prototype.skip=function(e){return e===void 0&&(e=1),this.offset+=e,this},t.prototype.seek=function(e){return this.offset=e,this},t.prototype.mark=function(){return this._mark=this.offset,this},t.prototype.reset=function(){return this.offset=this._mark,this},t.prototype.pushMark=function(){return this._marks.push(this.offset),this},t.prototype.popMark=function(){var e=this._marks.pop();if(e===void 0)throw new Error("Mark stack empty");return this.seek(e),this},t.prototype.rewind=function(){return this.offset=0,this},t.prototype.ensureAvailable=function(e){if(e===void 0&&(e=1),!this.available(e)){var n=this.offset+e,r=n*2,a=new Uint8Array(r);a.set(new Uint8Array(this.buffer)),this.buffer=a.buffer,this.length=this.byteLength=r,this._data=new DataView(this.buffer)}return this},t.prototype.readBoolean=function(){return this.readUint8()!==0},t.prototype.readInt8=function(){return this._data.getInt8(this.offset++)},t.prototype.readUint8=function(){return this._data.getUint8(this.offset++)},t.prototype.readByte=function(){return this.readUint8()},t.prototype.readBytes=function(e){e===void 0&&(e=1);for(var n=new Uint8Array(e),r=0;r<e;r++)n[r]=this.readByte();return n},t.prototype.readInt16=function(){var e=this._data.getInt16(this.offset,this.littleEndian);return this.offset+=2,e},t.prototype.readUint16=function(){var e=this._data.getUint16(this.offset,this.littleEndian);return this.offset+=2,e},t.prototype.readInt32=function(){var e=this._data.getInt32(this.offset,this.littleEndian);return this.offset+=4,e},t.prototype.readUint32=function(){var e=this._data.getUint32(this.offset,this.littleEndian);return this.offset+=4,e},t.prototype.readFloat32=function(){var e=this._data.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e},t.prototype.readFloat64=function(){var e=this._data.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e},t.prototype.readChar=function(){return String.fromCharCode(this.readInt8())},t.prototype.readChars=function(e){e===void 0&&(e=1);for(var n="",r=0;r<e;r++)n+=this.readChar();return n},t.prototype.readUtf8=function(e){return e===void 0&&(e=1),utf8.decode(this.readBytes(e))},t.prototype.writeBoolean=function(e){return this.writeUint8(e?255:0),this},t.prototype.writeInt8=function(e){return this.ensureAvailable(1),this._data.setInt8(this.offset++,e),this._updateLastWrittenByte(),this},t.prototype.writeUint8=function(e){return this.ensureAvailable(1),this._data.setUint8(this.offset++,e),this._updateLastWrittenByte(),this},t.prototype.writeByte=function(e){return this.writeUint8(e)},t.prototype.writeBytes=function(e){this.ensureAvailable(e.length);for(var n=0;n<e.length;n++)this._data.setUint8(this.offset++,e[n]);return this._updateLastWrittenByte(),this},t.prototype.writeInt16=function(e){return this.ensureAvailable(2),this._data.setInt16(this.offset,e,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this},t.prototype.writeUint16=function(e){return this.ensureAvailable(2),this._data.setUint16(this.offset,e,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this},t.prototype.writeInt32=function(e){return this.ensureAvailable(4),this._data.setInt32(this.offset,e,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this},t.prototype.writeUint32=function(e){return this.ensureAvailable(4),this._data.setUint32(this.offset,e,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this},t.prototype.writeFloat32=function(e){return this.ensureAvailable(4),this._data.setFloat32(this.offset,e,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this},t.prototype.writeFloat64=function(e){return this.ensureAvailable(8),this._data.setFloat64(this.offset,e,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this},t.prototype.writeChar=function(e){return this.writeUint8(e.charCodeAt(0))},t.prototype.writeChars=function(e){for(var n=0;n<e.length;n++)this.writeUint8(e.charCodeAt(n));return this},t.prototype.writeUtf8=function(e){return this.writeBytes(utf8.encode(e))},t.prototype.toArray=function(){return new Uint8Array(this.buffer,this.byteOffset,this.lastWrittenByte)},t.prototype._updateLastWrittenByte=function(){this.offset>this.lastWrittenByte&&(this.lastWrittenByte=this.offset)},t}(),utf8;(function(t){var e;(function(n){function r(o){if(o===void 0&&(o="utf-8"),o!=="utf-8")throw new RangeError("Failed to construct 'TextEncoder': The encoding label provided ('".concat(o,"') is invalid."))}Object.defineProperty(r.prototype,"encoding",{value:"utf-8"}),r.prototype.encode=function(o,s){if(s===void 0&&(s={stream:!1}),s.stream)throw new Error("Failed to encode: the 'stream' option is unsupported.");for(var i=0,f=o.length,c=[],u=0,h=Math.max(32,f+(f>>1)+7),l=new Uint8Array(h>>3<<3);i<f;){var d=o.charCodeAt(i++);if(d>=55296&&d<=56319){if(i<f){var v=o.charCodeAt(i);(v&64512)===56320&&(++i,d=((d&1023)<<10)+(v&1023)+65536)}if(d>=55296&&d<=56319)continue}if(u+4>l.length){h+=8,h*=1+i/o.length*2,h=h>>3<<3;var p=new Uint8Array(h);p.set(l),l=p}if(d&4294967168)if(!(d&4294965248))l[u++]=d>>6&31|192;else if(!(d&4294901760))l[u++]=d>>12&15|224,l[u++]=d>>6&63|128;else if(!(d&4292870144))l[u++]=d>>18&7|240,l[u++]=d>>12&63|128,l[u++]=d>>6&63|128;else continue;else{l[u++]=d;continue}l[u++]=d&63|128}return l.slice(0,u)};function a(o,s){if(o===void 0&&(o="utf-8"),s===void 0&&(s={fatal:!1}),o!=="utf-8")throw new RangeError("Failed to construct 'TextDecoder': The encoding label provided ('".concat(o,"') is invalid."));if(s.fatal)throw new Error("Failed to construct 'TextDecoder': the 'fatal' option is unsupported.")}Object.defineProperty(a.prototype,"encoding",{value:"utf-8"}),Object.defineProperty(a.prototype,"fatal",{value:!1}),Object.defineProperty(a.prototype,"ignoreBOM",{value:!1}),a.prototype.decode=function(o,s){if(s===void 0&&(s={stream:!1}),s.stream)throw new Error("Failed to decode: the 'stream' option is unsupported.");for(var i=new Uint8Array(o),f=0,c=i.length,u=[];f<c;){var h=i[f++];if(h===0)break;if(!(h&128))u.push(h);else if((h&224)===192){var l=i[f++]&63;u.push((h&31)<<6|l)}else if((h&240)===224){var l=i[f++]&63,d=i[f++]&63;u.push((h&31)<<12|l<<6|d)}else if((h&248)===240){var l=i[f++]&63,d=i[f++]&63,v=i[f++]&63,p=(h&7)<<18|l<<12|d<<6|v;p>65535&&(p-=65536,u.push(p>>>10&1023|55296),p=56320|p&1023),u.push(p)}}return String.fromCharCode.apply(null,u)}})(e=t.polyfill||(t.polyfill={}))})(utf8||(utf8={}));var utf8;(function(t){var e=new TextDecoder("utf-8");function n(o){return e.decode(o)}t.decode=n;var r=new TextEncoder;function a(o){return r.encode(o)}t.encode=a})(utf8||(utf8={}));var Type;(function(t){t.STREAMING=4294967295;function e(r,a){for(var o=t.str2num(a.type),s=a.size/t.num2bytes(o),i=new Array(s),f=0;f<s;f++)i[f]=t.readType(r,o,1);return i}t.nonRecord=e;function n(r,a,o){for(var s=t.str2num(a.type),i=a.size?a.size/t.num2bytes(s):1,f=o.length,c=new Array(f),u=o.recordStep,h=0;h<f;h++){var l=r.offset;c[h]=t.readType(r,s,i),r.seek(l+u)}return c}t.record=n})(Type||(Type={}));var Type;(function(t){function e(i){switch(Number(i)){case t.cdfTypes.BYTE:return"byte";case t.cdfTypes.CHAR:return"char";case t.cdfTypes.SHORT:return"short";case t.cdfTypes.INT:return"int";case t.cdfTypes.FLOAT:return"float";case t.cdfTypes.DOUBLE:return"double";default:return"undefined"}}t.num2str=e;function n(i){switch(Number(i)){case t.cdfTypes.BYTE:return 1;case t.cdfTypes.CHAR:return 1;case t.cdfTypes.SHORT:return 2;case t.cdfTypes.INT:return 4;case t.cdfTypes.FLOAT:return 4;case t.cdfTypes.DOUBLE:return 8;default:return-1}}t.num2bytes=n;function r(i){switch(String(i)){case"byte":return t.cdfTypes.BYTE;case"char":return t.cdfTypes.CHAR;case"short":return t.cdfTypes.SHORT;case"int":return t.cdfTypes.INT;case"float":return t.cdfTypes.FLOAT;case"double":return t.cdfTypes.DOUBLE;default:return-1}}t.str2num=r;function a(i,f){if(i!==1){for(var c=new Array(i),u=0;u<i;u++)c[u]=f();return c}else return f()}t.readNumber=a;function o(i,f,c){switch(f){case t.cdfTypes.BYTE:return i.readBytes(c);case t.cdfTypes.CHAR:return s(i.readChars(c));case t.cdfTypes.SHORT:return a(c,i.readInt16.bind(i));case t.cdfTypes.INT:return a(c,i.readInt32.bind(i));case t.cdfTypes.FLOAT:return a(c,i.readFloat32.bind(i));case t.cdfTypes.DOUBLE:return a(c,i.readFloat64.bind(i));default:utils.notNetcdf(!0,"non valid type ".concat(f));return}}t.readType=o;function s(i){return i.charCodeAt(i.length-1)===0?i.substring(0,i.length-1):i}t.trimNull=s})(Type||(Type={}));var Type;(function(t){t.cdfTypes={BYTE:1,CHAR:2,SHORT:3,INT:4,FLOAT:5,DOUBLE:6}})(Type||(Type={}));
